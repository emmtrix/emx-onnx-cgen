void {{ op_name }}({{ dim_args }}{% if dim_args and params %}, {% endif %}{{ params | join(', ') }}) {
    idx_t input_count = {{ input_sequence }}__count;
    if (input_count > EMX_SEQUENCE_MAX_LEN) {
        input_count = EMX_SEQUENCE_MAX_LEN;
    }

    for (idx_t seq = 0; seq < input_count; ++seq) {
        for (idx_t elem = 0; elem < {{ element_count }}; ++elem) {
            (({{ c_type }} *){{ output_sequence }}[seq])[elem] = ((const {{ c_type }} *){{ input_sequence }}[seq])[elem];
        }
    }

    *{{ output_sequence }}__count = input_count;
    {% if input_present and output_present %}
    *{{ output_present }} = {{ input_present }};
    {% endif %}
}
